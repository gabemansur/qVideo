<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>qVideo - Audio Video capture in Qualtrics</title>
  <meta name="description" content="Audio Video capture in Qualtrics">
  <meta name="author" content="Gabe Mansur">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

  <script src="https://cdn.WebRTC-Experiment.com/RecordRTC.js"></script>

  <link rel="stylesheet" href="css/styles.css?v=1.0">

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>

  <video autoplay></video>
  <br>
  <button id="record">Record</button>
  <button id="stop">Stop</button>

<script>
  $(document).ready(function() {
    $("#record").on('click', function(event) {
      startRecording();
    });

    $("#stop").on('click', function(event) {
      stopRecording();
    });
  });

</script>

<script>
var recordRTC;

const constraints = {
  video: true,
  audio: true,
};

const video = document.querySelector('video');

function handleSuccess(stream) {

  video.srcObject = stream;
  var options = {
    mimeType: 'video/webm', // or video/webm\;codecs=h264 or video/webm\;codecs=vp9
    audioBitsPerSecond: 128000,
    videoBitsPerSecond: 128000,
    bitsPerSecond: 128000 // if this line is provided, skip above two
  };
  recordRTC = RecordRTC(stream, options);
  recordRTC.startRecording();
}

function handleError(error) {
  console.error('Rejected!', error);
}

function startRecording() {
  navigator.mediaDevices.getUserMedia(constraints).
    then(handleSuccess).catch(handleError);
}

function stopRecording() {
  recordRTC.stopRecording(function (audioVideoWebMURL) {
        video.src = audioVideoWebMURL;

        var recordedBlob = recordRTC.getBlob();
        uploadMedia(123, recordedBlob);

  });
}

function uploadVideo(video) {

}

</script>

  <script src="js/qVideo.js"></script>
</body>
</html>
